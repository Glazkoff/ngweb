#  user                       nginx;
#  worker_processes           1;

# events {
#   worker_connections        1024;
# }

# http {
#   include                   /etc/nginx/mime.types;
#   client_max_body_size      100m;
#   upstream backend {
#     server                  backend:8000;
#   }
#   upstream frontend {
#     server                  frontend:8080;
#   }
#   server {
#     listen                  80;
#     charset                 utf-8;
#     #                       frontend urls
#     location / {
#       proxy_redirect        off;
#       proxy_pass            http://frontend;
#       proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
#       proxy_set_header      Host $http_host;
#     }
#     #                       frontend dev-server
#     location /sockjs-node {
#       proxy_redirect        off;
#       proxy_pass            http://frontend;
#       proxy_set_header      X-Real-IP $remote_addr;
#       proxy_set_header      X-Forwarded-For $remote_addr;
#       proxy_set_header      Host $host;
#       proxy_set_header      Upgrade $http_upgrade;
#       proxy_set_header      Connection "upgrade";
#     }
#     #                       backend urls
#     location ~ ^/(admin|api) {
#       proxy_redirect        off;
#       proxy_pass            http://backend;
#       proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
#       proxy_set_header      Host $http_host;
#     }
#     #                       backend static
#     location ~ ^/(staticfiles|media)/(.*)$ {
#       alias                 /$1/$2;
#     }
#   }
# }
server {
  listen                     80;
  listen                     [::]:80;

  index                      index.php index.html index.htm;

  root                       /var/www/html;

  location ~ /.well-known/acme-challenge {
    allow                    all;
    root                     /var/www/html;
  }

  location / {
    try_files                $uri $uri/ /index.php$is_args$args;
  }

  location ~ \.php$ {
    try_files                $uri =404;
    fastcgi_split_path_info  ^(.+\.php)(/.+)$;
    fastcgi_pass             wordpress:9000;
    fastcgi_index            index.php;
    include                  fastcgi_params;
    fastcgi_param            SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param            PATH_INFO $fastcgi_path_info;
  }

  location ~ /\.ht {
    deny                     all;
  }

  location = /favicon.ico {
    log_not_found            off; access_log off;
  }
  location = /robots.txt {
    log_not_found            off; access_log off; allow all;
  }
  location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ {
    expires                  max;
    log_not_found            off;
  }
}